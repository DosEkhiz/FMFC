<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Full Moon Fight Club — Bonded Beast Quiz</title>
  <style>
    :root{
      --bg:#07070a;
      --panel:#0f1016;
      --panel2:#0b0c12;
      --text:#f2f2f2;
      --muted:#b8b8c2;
      --gold:#d6b25e;
      --line:#262837;
      --bad:#ff6b6b;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
      background: radial-gradient(1200px 800px at 30% 0%, #121322 0%, var(--bg) 55%, #05050a 100%);
      color:var(--text);
      letter-spacing:.2px;
    }
    .wrap{max-width:920px;margin:0 auto;padding:24px 16px 64px;}
    .top{
      display:flex;flex-direction:column;gap:8px;margin:8px 0 18px 0;
      border:1px solid var(--line); border-radius:16px; padding:18px 16px;
      background: linear-gradient(180deg,var(--panel),var(--panel2));
    }
    h1{margin:0;font-size:22px;font-weight:800;letter-spacing:.6px}
    .sub{color:var(--muted); font-size:14px; line-height:1.4}
    .pill{
      display:inline-flex;align-items:center;gap:8px;
      color:var(--gold); font-weight:700; font-size:12px; letter-spacing:1px;
      text-transform:uppercase;
    }
    .bar{
      margin-top:10px;
      height:10px;border-radius:999px;background:#11121b;border:1px solid var(--line);
      overflow:hidden;
    }
    .bar > div{height:100%;width:0;background:linear-gradient(90deg,var(--gold),#fff1b1);}
    .card{
      margin-top:14px;
      border:1px solid var(--line); border-radius:16px;
      background: linear-gradient(180deg,var(--panel),var(--panel2));
      padding:18px 16px;
    }
    .qhead{display:flex;justify-content:space-between;gap:12px;align-items:flex-end;flex-wrap:wrap}
    .qnum{color:var(--gold);font-weight:800;letter-spacing:1px}
    .qtitle{font-size:18px;font-weight:800;margin:6px 0 0 0}
    .hint{color:var(--muted);font-size:13px}
    .opts{display:grid;grid-template-columns:1fr;gap:10px;margin-top:14px}
    .opt{
      display:flex;gap:12px;align-items:flex-start;
      padding:12px 12px;border-radius:14px;
      border:1px solid var(--line);
      background: rgba(255,255,255,0.02);
      cursor:pointer;
      transition: transform .05s ease, border-color .15s ease, background .15s ease;
      user-select:none;
    }
    .opt:hover{border-color:#3a3d55;background:rgba(255,255,255,0.04)}
    .opt input{margin-top:3px; transform:scale(1.1)}
    .opt .txt{line-height:1.25}
    .row{display:flex;gap:12px;justify-content:space-between;align-items:center;margin-top:16px;flex-wrap:wrap}
    .err{color:var(--bad);font-weight:700;font-size:13px;display:none}
    button{
      appearance:none;border:1px solid var(--line);
      background:#141628;color:var(--text);
      padding:10px 14px;border-radius:12px;
      font-weight:800; letter-spacing:.4px;
      cursor:pointer;
    }
    button.primary{
      background: linear-gradient(180deg, #1a1c2f, #111225);
      border-color:#3a3d55;
    }
    button.primary:hover{border-color:#6a5a2c}
    button:disabled{opacity:.45;cursor:not-allowed}
    .result{
      border:1px solid var(--line); border-radius:16px;
      background: linear-gradient(180deg,var(--panel),var(--panel2));
      padding:22px 16px;margin-top:16px;
    }
    .rmeta{color:var(--gold);font-weight:900;letter-spacing:1px;text-transform:uppercase;font-size:12px}
    .mini{color:var(--muted);font-size:12px;margin-top:8px}
    .pair{
      margin-top:14px;
      border:1px solid #2a2d41;
      border-radius:14px;
      padding:12px 12px;
      background: rgba(255,255,255,0.02);
    }
    .pair h3{margin:0 0 6px 0; font-size:12px; letter-spacing:.8px; text-transform:uppercase; color:var(--muted)}
    .pair .line{display:flex;flex-wrap:wrap;gap:10px;align-items:baseline}
    .pair .big{font-size:18px;font-weight:900;letter-spacing:.6px}
    .pair .small{color:var(--muted);font-size:12px}
    .twoCol{display:grid;grid-template-columns:1fr;gap:12px;margin-top:14px}
    @media(min-width:760px){ .twoCol{grid-template-columns:1fr 1fr;} }
    .scores{display:none;}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="top">
      <div class="pill">Full Moon Fight Club • Bonded Beast</div>
      <h1>Choose the Bond that completes you.</h1>
      <div class="sub">
        First, select your <b>fighter persona</b>. Then answer 6 questions:
        choose <b>exactly two</b> options each. Your two Bond recommendations appear at the end.
      </div>
      <div class="bar" aria-label="progress">
        <div id="progress"></div>
      </div>
    </div>

    <div id="app"></div>
  </div>

<script>
/** ====== CANON ARCHETYPES ====== */
const ARCHETYPES = {
  duelist: { name:"THE DUELIST", meta:"Finesse (₪Ꚛ)", bondRole:"Precision Assist",
    body:["A Bonded Beast that sees the opening before it exists.","It sharpens exchanges, punishes mistakes, and keeps your wins clean."],
    bullets:["Punish openings","Win on timing","Turn defense into advantage"] },
  dominator: { name:"THE DOMINATOR", meta:"Impact (₪Ͽ)", bondRole:"Tempo Accelerant",
    body:["A Bonded Beast that forces decisions.","It creates pressure, collapses space, and makes hesitation lethal."],
    bullets:["Create pressure","Commit first","Break momentum"] },
  anchor: { name:"THE ANCHOR", meta:"Grit (₪Ø)", bondRole:"Stabilizer",
    body:["A Bonded Beast that keeps you alive when the fight turns ugly.","It absorbs chaos, buys time, and turns endurance into advantage."],
    bullets:["Outlast swings","Stay composed","Refuse to fall"] },
  executioner: { name:"THE EXECUTIONER", meta:"Impact + Finesse (ϿꚚ)", bondRole:"Converter",
    body:["A Bonded Beast that turns advantage into the end.","It waits, watches, then finishes decisively the moment it’s possible."],
    bullets:["Punish hard","Convert openings","End exchanges"] },
  controller: { name:"THE CONTROLLER", meta:"Finesse + Grit (ꚚØ)", bondRole:"Fight Architect",
    body:["A Bonded Beast that makes chaos predictable.","It controls pace, positioning, and denies traps."],
    bullets:["Control pace","Own positioning","Turn chaos into order"] },
  juggernaut: { name:"THE JUGGERNAUT", meta:"Grit + Impact (ØϿ)", bondRole:"Collision Engine",
    body:["A Bonded Beast that reshapes space through force.","It wins by displacement, pressure, and collision."],
    bullets:["Take space","Force movement","Win by pressure + mass"] },
};

const ORDER = ["duelist","dominator","anchor","executioner","controller","juggernaut"];

/** ====== PERSONA → LEAN / GAP PAIRS (calibration) ======
 * Lean In = adjacencies from your canon WEIGHTS map.
 * Fill Gap = complements (2 options) per persona.
 */
const LEAN_IN = {
  duelist:     ["controller","executioner"],
  dominator:   ["executioner","juggernaut"],
  anchor:      ["controller","juggernaut"],
  executioner: ["duelist","dominator"],
  controller:  ["duelist","anchor"],
  juggernaut:  ["anchor","dominator"],
};
const FILL_GAP = {
  duelist:     ["anchor","juggernaut"],
  dominator:   ["controller","anchor"],
  anchor:      ["executioner","dominator"],
  executioner: ["controller","anchor"],
  controller:  ["dominator","executioner"],
  juggernaut:  ["duelist","controller"],
};

/** ====== QUIZ QUESTIONS (archetypes hidden) ====== */
const QUESTIONS = [
  {
    prompt: "When the fight goes sideways, you want your Bonded Beast to:",
    options: [
      { text: "Mark the opening.", key: "duelist" },
      { text: "Force the decision.", key: "dominator" },
      { text: "Hold us together.", key: "anchor" },
      { text: "End it the moment it’s possible.", key: "executioner" },
      { text: "Slow the chaos down.", key: "controller" },
      { text: "Move bodies and reset space.", key: "juggernaut" },
    ]
  },
  {
    prompt: "The kind of support that feels best is:",
    options: [
      { text: "Cleaner exchanges.", key: "duelist" },
      { text: "More pressure.", key: "dominator" },
      { text: "More survival.", key: "anchor" },
      { text: "More conversion.", key: "executioner" },
      { text: "More control.", key: "controller" },
      { text: "More collision.", key: "juggernaut" },
    ]
  },
  {
    prompt: "If your Bond had one job, it would be to:",
    options: [
      { text: "Punish mistakes.", key: "duelist" },
      { text: "Create momentum.", key: "dominator" },
      { text: "Refuse to fall.", key: "anchor" },
      { text: "Finish clean.", key: "executioner" },
      { text: "Own positioning.", key: "controller" },
      { text: "Break formations.", key: "juggernaut" },
    ]
  },
  {
    prompt: "You trust a teammate most when they are:",
    options: [
      { text: "Quiet and precise.", key: "duelist" },
      { text: "Aggressive and committed.", key: "dominator" },
      { text: "Calm and unbreakable.", key: "anchor" },
      { text: "Patient… then lethal.", key: "executioner" },
      { text: "Composed and strategic.", key: "controller" },
      { text: "Relentless and physical.", key: "juggernaut" },
    ]
  },
  {
    prompt: "Your favorite 2v2 plan looks like:",
    options: [
      { text: "Win exchanges clean.", key: "duelist" },
      { text: "Overwhelm with pace.", key: "dominator" },
      { text: "Survive their spike.", key: "anchor" },
      { text: "One mistake → end.", key: "executioner" },
      { text: "Control space and tempo.", key: "controller" },
      { text: "Force displacement.", key: "juggernaut" },
    ]
  },
  {
    prompt: "In a highlight clip, your Bonded Beast is the one who:",
    options: [
      { text: "Threads the needle.", key: "duelist" },
      { text: "Starts the avalanche.", key: "dominator" },
      { text: "Won’t go down.", key: "anchor" },
      { text: "Gets the final word.", key: "executioner" },
      { text: "Makes them look lost.", key: "controller" },
      { text: "Sends someone flying.", key: "juggernaut" },
    ]
  },
];

const EXACT_PICKS = 2;

/** ====== STATE ====== */
let stage = "persona"; // persona -> quiz -> result
let qIndex = 0;
let fighterPersona = null;
const answers = QUESTIONS.map(() => new Set());

/** ====== SCORING (Bond preference signal) ======
 * We keep scoring simple: each selected option adds +1 to that key.
 * (You could re-add adjacency scoring later if you want, but it isn't needed now because
 * lean/gap calibrates off the chosen fighter persona.)
 */
function emptyScores(){
  return { duelist:0, dominator:0, anchor:0, executioner:0, controller:0, juggernaut:0 };
}
function computeScores(){
  const scores = emptyScores();
  QUESTIONS.forEach((q, qi) => {
    for (const optIndex of answers[qi]) {
      const key = q.options[optIndex].key;
      scores[key] += 1;
    }
  });
  return scores;
}
function bestOf(keys, scores){
  let best = keys[0], bestV = -Infinity;
  for (const k of keys){
    if (scores[k] > bestV){ bestV = scores[k]; best = k; }
  }
  return best;
}

/** ====== UI ====== */
const app = document.getElementById("app");
const progressEl = document.getElementById("progress");

function render(){
  // progress: persona stage = 0, quiz stage = qIndex/6, result stage = 100%
  const pct = stage === "persona" ? 0
            : stage === "quiz" ? Math.round((qIndex / QUESTIONS.length) * 100)
            : 100;
  progressEl.style.width = `${pct}%`;

  if (stage === "persona") return renderPersonaPick();
  if (stage === "quiz") return renderQuestion();
  return renderResult();
}

function renderPersonaPick(){
  app.innerHTML = `
    <div class="card">
      <div class="qhead">
        <div>
          <div class="qnum">SETUP</div>
          <div class="qtitle">What’s your fighter persona?</div>
        </div>
        <div class="hint">Required • Choose one</div>
      </div>

      <div class="opts">
        ${ORDER.map(k => {
          const a = ARCHETYPES[k];
          const checked = (fighterPersona === k) ? "checked" : "";
          return `
            <label class="opt">
              <input type="radio" name="persona" value="${k}" ${checked}/>
              <div class="txt">
                <div style="font-weight:900">${escapeHtml(a.name)}</div>
                <div style="color:var(--muted); font-size:12px; margin-top:4px">${escapeHtml(a.meta)}</div>
              </div>
            </label>
          `;
        }).join("")}
      </div>

      <div class="row">
        <div class="err" id="err">Select your fighter persona to continue.</div>
        <div style="display:flex; gap:10px; margin-left:auto;">
          <button class="primary" id="start">Start Bond Quiz</button>
        </div>
      </div>
      <div class="mini">This does not influence your answers — it only calibrates “Lean In” vs “Fill the Gap.”</div>
    </div>
  `;

  app.querySelectorAll('input[name="persona"]').forEach(r => {
    r.addEventListener("change", (e) => {
      fighterPersona = e.target.value;
      hideError();
    });
  });

  app.querySelector("#start").addEventListener("click", () => {
    if (!fighterPersona){
      showError();
      return;
    }
    stage = "quiz";
    qIndex = 0;
    render();
  });
}

function renderQuestion(){
  if (qIndex >= QUESTIONS.length){
    stage = "result";
    render();
    return;
  }

  const q = QUESTIONS[qIndex];

  app.innerHTML = `
    <div class="card">
      <div class="qhead">
        <div>
          <div class="qnum">QUESTION ${qIndex+1} / ${QUESTIONS.length}</div>
          <div class="qtitle">${escapeHtml(q.prompt)}</div>
        </div>
        <div class="hint">Choose exactly <b>${EXACT_PICKS}</b></div>
      </div>

      <div class="opts">
        ${q.options.map((opt, i) => {
          const checked = answers[qIndex].has(i) ? "checked" : "";
          return `
            <label class="opt">
              <input type="checkbox" data-idx="${i}" ${checked} />
              <div class="txt">${escapeHtml(opt.text)}</div>
            </label>
          `;
        }).join("")}
      </div>

      <div class="row">
        <div class="err" id="err">Choose exactly ${EXACT_PICKS} options to continue.</div>
        <div style="display:flex; gap:10px; margin-left:auto;">
          <button id="back" ${qIndex===0 ? "disabled":""}>Back</button>
          <button class="primary" id="next">Next</button>
        </div>
      </div>
    </div>
  `;

  app.querySelectorAll('input[type="checkbox"]').forEach(cb => {
    cb.addEventListener("change", (e) => {
      const idx = parseInt(e.target.dataset.idx, 10);
      const set = answers[qIndex];

      if (e.target.checked){
        if (set.size >= EXACT_PICKS){
          e.target.checked = false;
          return;
        }
        set.add(idx);
      } else {
        set.delete(idx);
      }
      hideError();
    });
  });

  app.querySelector("#back").addEventListener("click", () => {
    hideError();
    qIndex = Math.max(0, qIndex-1);
    render();
  });

  app.querySelector("#next").addEventListener("click", () => {
    if (answers[qIndex].size !== EXACT_PICKS){
      showError();
      return;
    }
    hideError();
    qIndex += 1;
    render();
  });
}

function renderArchetypeCard(label, key){
  const a = ARCHETYPES[key];
  return `
    <div class="pair">
      <h3>${escapeHtml(label)}</h3>
      <div class="line">
        <div class="big">${escapeHtml(a.name)}</div>
        <div class="small">• ${escapeHtml(a.meta)} • ${escapeHtml(a.bondRole)}</div>
      </div>
      <div class="mini" style="margin-top:10px; line-height:1.5">
        ${a.body.map(p => `<div style="margin-top:6px">${escapeHtml(p)}</div>`).join("")}
        <div style="margin-top:10px; font-weight:900; color:#fff">In the Ring, this Bond:</div>
        <ul style="margin:8px 0 0 18px; padding:0; color:var(--muted)">
          ${a.bullets.map(b=>`<li>${escapeHtml(b)}</li>`).join("")}
        </ul>
      </div>
    </div>
  `;
}

function renderResult(){
  progressEl.style.width = `100%`;

  const scores = computeScores();

  // Calibrated recommendations based on fighter persona:
  // - Lean In comes from the fighter persona's lean-in set, choosing the one the quiz answers favor most.
  // - Fill Gap comes from the fighter persona's fill-gap set, choosing the one the quiz answers favor most.
  const leanPartner = bestOf(LEAN_IN[fighterPersona], scores);
  const gapPartner  = bestOf(FILL_GAP[fighterPersona], scores);

  app.innerHTML = `
    <div class="result">
      <div class="rmeta">RESULT • TWO BONDED BEAST RECOMMENDATIONS</div>
      <div class="mini" style="margin-top:8px">
        Calibrated from your fighter persona: <b>${escapeHtml(ARCHETYPES[fighterPersona].name)}</b>
      </div>

      <div class="twoCol" style="margin-top:14px">
        ${renderArchetypeCard("Lean In Bond (Amplify Your Style)", leanPartner)}
        ${renderArchetypeCard("Fill the Gap Bond (Cover Your Weakness)", gapPartner)}
      </div>

      <div class="row" style="margin-top:16px">
        <button id="restart">Retake</button>
        <button class="primary" id="copy">Copy Result</button>
      </div>

      <div class="mini">Next step: choose a specific Bonded Beast that fits one of these two bond styles.</div>

      <div class="scores" id="debug">
        ${Object.entries(scores).map(([k,v])=>`${k}: ${v}`).join(" | ")}
      </div>
    </div>
  `;

  app.querySelector("#restart").addEventListener("click", () => {
    stage = "persona";
    fighterPersona = null;
    qIndex = 0;
    for (let i=0;i<answers.length;i++) answers[i] = new Set();
    render();
  });

  app.querySelector("#copy").addEventListener("click", async () => {
    const text =
      `FMFC Bonded Beast Quiz — Fighter: ${ARCHETYPES[fighterPersona].name} • Lean In: ${ARCHETYPES[leanPartner].name} • Fill the Gap: ${ARCHETYPES[gapPartner].name}`;
    try{
      await navigator.clipboard.writeText(text);
      app.querySelector("#copy").textContent = "Copied";
      setTimeout(()=> app.querySelector("#copy").textContent = "Copy Result", 900);
    } catch(e){
      alert(text);
    }
  });
}

function showError(){
  const el = app.querySelector("#err");
  if (el){ el.style.display = "block"; }
}
function hideError(){
  const el = app.querySelector("#err");
  if (el){ el.style.display = "none"; }
}

function escapeHtml(str){
  return String(str)
    .replaceAll("&","&amp;")
    .replaceAll("<","&lt;")
    .replaceAll(">","&gt;")
    .replaceAll('"',"&quot;")
    .replaceAll("'","&#039;");
}

render();
</script>
</body>
</html>
